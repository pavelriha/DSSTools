
<div class="topbar">

    <div class="head">
        <div ngDropdown [renderInPlace]="true" #repoDropdown="ngDropdown" >
            <div ngDropdownControl >
                <span class="text">Verze: {{ this.controlService.selectedRepository }}</span>
                <span class="arrow"><i class="fas fa-chevron-down"></i></span>
            </div>
            <div ngDropdownContent dropdownClass="slide-fade invert">
                <ul class="select" *ngIf="repolist">
                    <!-- <li *ngFor="let v of repolist" (click)="repo=v.key;repoValue=v.value; repoDropdown.close(); repoChange();">{{v.value}}</li> -->
                    <li *ngFor="let v of repolist" (click)="repoDropdown.close(); repoChange(v);">{{v}}</li>
                </ul>
            </div>
        </div>
        <user-panel *ngIf="userdata"></user-panel>

                
        <br>
        <img class="logo" src="assets/images/bim-logo.svg">
    </div>

    <ul class="filter">
        <!-- <li><app-filter-box #repo [name]="'Verze'" [nodes]="nodesRepositories" ></app-filter-box></li> -->
        <li [class.notready]="!filtersready" style="flex-grow: 10;">
            <app-filter-box #breaks [name]="'Datové šablony'" [nodes]="nodesBreakdown" [nodesSplit]="true" [toolbarButton]="buttonnewdt" >
                <ng-template #buttonnewdt>
                        <a class="button newdt" (click)="modal.open('modal-new-dt')"  *ngIf="userdata">
                            <i class="fas fa-plus" title="Přidat novou datovou šablonu"></i>
                        </a>
                </ng-template>
                <modal id="modal-new-dt">
                    <notes-dt-new [finish]="newDtDone"></notes-dt-new>
                </modal>
            </app-filter-box>
        </li>
        
        <li [class.notready]="!filtersready"><app-filter-box #actors [name]="'Aktéři'" [nodes]="nodesActors" ></app-filter-box></li>
    
        <li [class.notready]="!filtersready"><app-filter-box #milestones [name]="'Stupeň projektové dokumentace'" [nodes]="nodesMilestones" ></app-filter-box></li>
        <li [class.notready]="!filtersready"><app-filter-box #reasons [name]="'Účely užití'" [nodes]="nodesReasons" ></app-filter-box></li>

        <li class="cancel" *ngIf="breaks.selected.length || actors.selected.length || milestones.selected.length || reasons.selected.length">
            <div class="">
                <a class="button" (click)="deselectAll()" title="Zrušit všechny filtry">
                    <svg class="icon" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                    </svg>
                </a>
            </div>
        </li>
    </ul>
    
    <div class="buttons-wrapper">
        <div class="buttons-bar">
            <div class="line">
                <div class="button search" [class.notready]="!filtersready" (click)="runfilter()" gaEvent="b_zobrazit" gaCategory="ga_buttons"><span class="placeholder">Zobrazit</span><span class="text">Zobrazit</span> </div>
                <div class="button bookmarks" ngDropdown [renderInPlace]="false" #bookmarkDropdown="ngDropdown">
                    <span ngDropdownControl>&nbsp;<i class="fas fa-star"></i>&nbsp;</span>
                    <div ngDropdownContent dropdownClass="slide-fade dropdown-bookmarks" >

                        <div class="add">
                            <h3>Uložte si současné nastavení filtrů</h3>
                            <form class="" (submit)="addBookmark(bmname); bmname='';">
                                <input type="text" name="bmname" [(ngModel)]="bmname" placeholder="pojmenujte si záložku">
                                <button type="submit" class="submit" [disabled]="!bmname">uložit</button>
                            </form>
                        </div>
                            
                        <div *ngIf="bookmarkService.bookmarks.length>0">
                            <h3>Vyberte uložený filtr</h3>
                            <div class="bookmark" *ngFor="let b of bookmarkService.bookmarks; let i = index">
                                <span class="name actions__item" (click)="restoreBookmark(b);bookmarkDropdown.close()">{{b.name}}</span>
                                &nbsp; <i class="far fa-trash-alt actions__item control" (click)="bookmarkService.delBookmark(i)" title="Odstranit"></i>
                            </div>
                        </div>
                        <div class="empty" *ngIf="bookmarkService.bookmarks.length==0">
                            Nemáte zatím žádné uložené nastavení
                        </div>
                    </div>
                </div>
            </div>
            <div class="line">
                <div class="button" [class.notready]="!filtersready" (click)="exportIFC()" gaEvent="b_export_ifc" gaCategory="ga_buttons" >Export IFC</div>
                <div class="button" [class.notready]="!filtersready" (click)="exportXLS()" gaEvent="b_export_xls" gaCategory="ga_buttons">Export XLS</div>
            </div>
        </div>
        <div class="help">
            <a target="_blank" [href]="help_url">Stručný popis ovládání</a>
        </div>


    </div>

</div>

<br><br>


<div class="output">

    <div class="loading fa-3x" *ngIf="dataLoading">
        <i class="fa fa-spinner fa-spin"></i>
    </div>

    <ul class="error" *ngIf="errors.length">
        <h2>Omlouváme se, ale bohužel došlo k chybě</h2>
        <li *ngFor="let e of errors">{{ e }}</li>
    </ul>

    <ng-container *ngIf="!dataLoading && !errors.length">

        <div class="info" *ngIf="!selectedTree">
            Pro zobrazení obsahu DSS zadejte pomocí filtrů rozsah požadovaných informací (minimálně vyberte rozsah datových šablon) a stiskněte tlačítko "ZOBRAZIT". 
            <br>
            <a target="_blank" [href]="help_url">Stručnou nápovědu k ovládání naleznete zde</a>
        </div>

        <ng-container *ngIf="selectedTree"  >

            <ul class="bar2">
                <li class="style" [class.active]="reqtab=='req'" (click)="reqtabChange('req')"><i class="fas  fa-list" title="Vlastnosti"></i><b>&nbsp;</b></li>
                <li class="style" [class.active]="reqtab=='sets_cz'" (click)="reqtabChange('sets_cz')"><i class="fas fa-stream" title="Skupiny vlastností CZ"></i><b>DSS</b></li>
                <!--
                    <li class="style" [class.active]="reqtab=='sets_en'" (click)="reqtabChange('sets_en')"><i class="fas fa-stream" title="Skupiny vlastností EN"></i></li>
                -->
                <li class="style" [class.active]="reqtab=='sets_ifc'" (click)="reqtabChange('sets_ifc')"><i class="fas fa-stream" title="Skupiny vlastností IFC"></i><b>IFC</b></li>
                <li class="style" [class.active]="ifc" (click)="ifc=!ifc" title="zobrazit IFC sloupce"> IFC <b>&nbsp;</b></li>
            </ul>

            <breakdown-requirements 
                [tree]="selectedTree" 
                [flat]="selectedFlatTree" 
                [data]="dataTemplates" 
                [style]="reqtab" 
                [ifc]="ifc" 
                [notesreq]="notesReqData"
                [milestones]="selectedMilestones"
                ></breakdown-requirements>
            
        </ng-container>
        
    </ng-container>
    
</div>

<app-footer></app-footer>